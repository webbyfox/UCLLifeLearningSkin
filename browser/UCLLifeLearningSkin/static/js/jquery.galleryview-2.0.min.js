var window_loaded=false;(function(a){a.fn.galleryView=function(b){function K(b){a(".nav-next-overlay",E).unbind("click");a(".nav-prev-overlay",E).unbind("click");a(".nav-next",E).unbind("click");a(".nav-prev",E).unbind("click");G.unbind("click");if(c.show_filmstrip){G.removeClass("current").find("img").stop().animate({opacity:c.frame_opacity},c.transition_speed);G.eq(b).addClass("current").find("img").stop().animate({opacity:1},c.transition_speed)}if(c.show_panels&&c.fade_panels){I.fadeOut(c.transition_speed).eq(b%f).fadeIn(c.transition_speed,function(){if(!c.show_filmstrip){a(".nav-prev-overlay",E).click(O);a(".nav-next-overlay",E).click(N);a(".nav-prev",E).click(O);a(".nav-next",E).click(N)}})}if(c.show_filmstrip){if(g=="strip"){F.stop();if(x=="horizontal"){var d=P(G[b]).left-(P(J[0]).left+n/2-s/2);var h=(d>=0?"-=":"+=")+Math.abs(d)+"px";F.animate({left:h},c.transition_speed,c.easing,function(){var d=b;if(b>f){b=b%f;e=b;F.css("left","-"+(s+c.frame_gap)*b+"px")}else if(b<=f-strip_size){b=b%f+f;e=b;F.css("left","-"+(s+c.frame_gap)*b+"px")}if(d!=b){G.eq(d).removeClass("current").find("img").css({opacity:c.frame_opacity});G.eq(b).addClass("current").find("img").css({opacity:1})}if(!c.fade_panels){I.hide().eq(b%f).show()}a(".nav-prev-overlay",E).click(O);a(".nav-next-overlay",E).click(N);a(".nav-prev",E).click(O);a(".nav-next",E).click(N);Q()})}else{var d=P(G[b]).top-(P(J[0]).top+m-t/2);var h=(d>=0?"-=":"+=")+Math.abs(d)+"px";F.animate({top:h},c.transition_speed,c.easing,function(){var d=b;if(b>f){b=b%f;e=b;F.css("top","-"+(t+c.frame_gap)*b+"px")}else if(b<=f-strip_size){b=b%f+f;e=b;F.css("top","-"+(t+c.frame_gap)*b+"px")}if(d!=b){G.eq(d).removeClass("current").find("img").css({opacity:c.frame_opacity});G.eq(b).addClass("current").find("img").css({opacity:1})}if(!c.fade_panels){I.hide().eq(b%f).show()}a(".nav-prev-overlay",E).click(O);a(".nav-next-overlay",E).click(N);a(".nav-prev",E).click(O);a(".nav-next",E).click(N);Q()})}}else if(g=="pointer"){J.stop();var i=P(G[b]);if(x=="horizontal"){J.animate({left:i.left+s/2-n/2+"px"},c.transition_speed,c.easing,function(){if(!c.fade_panels){I.hide().eq(b%f).show()}a(".nav-prev-overlay",E).click(O);a(".nav-next-overlay",E).click(N);a(".nav-prev",E).click(O);a(".nav-next",E).click(N);Q()})}else{J.animate({top:i.top+t/2-m+"px"},c.transition_speed,c.easing,function(){if(!c.fade_panels){I.hide().eq(b%f).show()}a(".nav-prev-overlay",E).click(O);a(".nav-next-overlay",E).click(N);a(".nav-prev",E).click(O);a(".nav-next",E).click(N);Q()})}}}}function L(a){if(!a)return 0;if(a.length==0)return 0;a=a.eq(0);var b=0;b+=U(a.css("paddingLeft"));b+=U(a.css("paddingRight"));b+=U(a.css("borderLeftWidth"));b+=U(a.css("borderRightWidth"));return b}function M(a){if(!a)return 0;if(a.length==0)return 0;a=a.eq(0);var b=0;b+=U(a.css("paddingTop"));b+=U(a.css("paddingBottom"));b+=U(a.css("borderTopWidth"));b+=U(a.css("borderBottomWidth"));return b}function N(){a(document).stopTime("transition");if(++e==G.length){e=0}K(e);if(!j){a(document).everyTime(c.transition_interval,"transition",function(){N()})}}function O(){a(document).stopTime("transition");if(--e<0){e=f-1}K(e);if(!j){a(document).everyTime(c.transition_interval,"transition",function(){N()})}}function P(a){var b=0,c=0;var e=a.id;if(a.offsetParent){do{b+=a.offsetLeft;c+=a.offsetTop}while(a=a.offsetParent)}if(e==d){return{left:b,top:c}}else{var f=P(E[0]);var g=f.left;var h=f.top;return{left:b-g,top:c-h}}}function Q(){G.each(function(b){if(a("a",this).length==0){a(this).click(function(){if(e!=b){a(document).stopTime("transition");K(b);e=b;if(!j){a(document).everyTime(c.transition_interval,"transition",function(){N()})}}})}})}function R(){I.each(function(b){if(a(".panel-overlay",this).length>0){a(this).append('<div class="overlay-background"></div>')}});if(!c.show_filmstrip){a("<img />").addClass("nav-next").attr("src",h+c.nav_theme+"/next.gif").appendTo(E).css({position:"absolute",zIndex:"1100",cursor:"pointer",top:(c.panel_height-22)/2+v+"px",right:"10px",display:"none"}).click(N);a("<img />").addClass("nav-prev").attr("src",h+c.nav_theme+"/prev.gif").appendTo(E).css({position:"absolute",zIndex:"1100",cursor:"pointer",top:(c.panel_height-22)/2+v+"px",left:"10px",display:"none"}).click(O);a("<img />").addClass("nav-next-overlay").attr("src",h+c.nav_theme+"/panel-nav-next.gif").appendTo(E).css({position:"absolute",zIndex:"1099",top:(c.panel_height-22)/2+v-10+"px",right:"0",display:"none",cursor:"pointer",opacity:.75}).click(N);a("<img />").addClass("nav-prev-overlay").attr("src",h+c.nav_theme+"/panel-nav-prev.gif").appendTo(E).css({position:"absolute",zIndex:"1099",top:(c.panel_height-22)/2+v-10+"px",left:"0",display:"none",cursor:"pointer",opacity:.75}).click(O)}I.each(function(b){a(this).css({width:c.panel_width-L(I)+"px",height:c.panel_height-M(I)+"px",position:"absolute",overflow:"hidden",display:"none"});switch(c.filmstrip_position){case"top":a(this).css({top:q+Math.max(v,w)+"px",left:v+"px"});break;case"left":a(this).css({top:v+"px",left:o+Math.max(v,w)+"px"});break;default:a(this).css({top:v+"px",left:v+"px"});break}});if(c.overlay_width!="None")var b=c.overlay_width;else var b=c.panel_width;if(c.overlay_starting_point!="None")var d=c.overlay_starting_point+"px";else var d="0";if(c.overlay_height!="None")var e=c.overlay_height+"px";else var e="";a(".panel-overlay",I).css({position:"absolute",zIndex:"999",width:b-L(a(".panel-overlay",I))+"px",left:d,height:e});a(".overlay-background",I).css({position:"absolute",zIndex:"998",width:b+"px",left:d,opacity:c.overlay_opacity,height:e});if(c.overlay_position=="top"){a(".panel-overlay",I).css("top",0);a(".overlay-background",I).css("top",0)}else{a(".panel-overlay",I).css("bottom",0);a(".overlay-background",I).css("bottom",0)}a(".panel iframe",I).css({width:c.panel_width+"px",height:c.panel_height+"px",border:"0"});if(C){a("img",I).each(function(b){a(this).css({height:z[b%f]*A[b%f],width:z[b%f]*B[b%f],position:"relative",top:(c.panel_height-z[b%f]*A[b%f])/2+"px",left:(c.panel_width-z[b%f]*B[b%f])/2+"px"})})}}function S(){F.wrap('<div class="strip_wrapper"></div>');if(g=="strip"){G.clone().appendTo(F);G.clone().appendTo(F);G=a("li",F)}if(c.show_captions){G.append('<div class="caption"></div>').each(function(b){a(this).find(".caption").html(a(this).find("img").attr("title"))})}F.css({listStyle:"none",margin:"0",padding:"0",width:o+"px",position:"absolute",zIndex:"900",top:(x=="vertical"&&g=="strip"?-((t+c.frame_gap)*e):0)+"px",left:(x=="horizontal"&&g=="strip"?-((s+c.frame_gap)*e):0)+"px",height:q+"px"});G.css({"float":"left",position:"relative",height:t+(c.show_captions?u:0)+"px",width:s+"px",zIndex:"901",padding:"0",cursor:"pointer"});switch(c.filmstrip_position){case"top":G.css({marginBottom:w+"px",marginRight:c.frame_gap+"px"});break;case"bottom":G.css({marginTop:w+"px",marginRight:c.frame_gap+"px"});break;case"left":G.css({marginRight:w+"px",marginBottom:c.frame_gap+"px"});break;case"right":G.css({marginLeft:w+"px",marginBottom:c.frame_gap+"px"});break}a(".img_wrap",G).each(function(b){a(this).css({height:Math.min(c.frame_height,A[b%f]*y[b%f])+"px",width:Math.min(c.frame_width,B[b%f]*y[b%f])+"px",position:"relative",top:(c.show_captions&&c.filmstrip_position=="top"?u:0)+Math.max(0,(c.frame_height-y[b%f]*A[b%f])/2)+"px",left:Math.max(0,(c.frame_width-y[b%f]*B[b%f])/2)+"px",overflow:"hidden"})});a("img",G).each(function(b){a(this).css({opacity:c.frame_opacity,height:A[b%f]*y[b%f]+"px",width:B[b%f]*y[b%f]+"px",position:"relative",top:Math.min(0,(c.frame_height-y[b%f]*A[b%f])/2)+"px",left:Math.min(0,(c.frame_width-y[b%f]*B[b%f])/2)+"px"}).mouseover(function(){a(this).stop().animate({opacity:1},300)}).mouseout(function(){if(!a(this).parent().parent().hasClass("current"))a(this).stop().animate({opacity:c.frame_opacity},300)})});a(".strip_wrapper",E).css({position:"absolute",overflow:"hidden"});if(x=="horizontal"){a(".strip_wrapper",E).css({top:c.filmstrip_position=="top"?Math.max(v,w)+"px":c.panel_height+v+"px",left:(k-r)/2+v+"px",width:r+"px",height:q+"px"})}else{a(".strip_wrapper",E).css({left:c.filmstrip_position=="left"?Math.max(v,w)+"px":c.panel_width+v+"px",top:Math.max(v,c.frame_gap)+"px",width:o+"px",height:wrapper_height+"px"})}a(".caption",E).css({position:"absolute",top:(c.filmstrip_position=="bottom"?t:0)+"px",left:"0",margin:"0",width:s+"px",padding:"0",height:u+"px",overflow:"hidden",lineHeight:u+"px"});var b=a("<div></div>");b.addClass("pointer").appendTo(E).css({position:"absolute",zIndex:"1000",width:"0px",fontSize:"0px",lineHeight:"0%",borderTopWidth:m+"px",borderRightWidth:n/2+"px",borderBottomWidth:m+"px",borderLeftWidth:n/2+"px",borderStyle:"solid"});var d=a.browser.msie&&a.browser.version.substr(0,1)=="6"?"pink":"transparent";if(!c.show_panels){b.css("borderColor",d)}switch(c.filmstrip_position){case"top":b.css({bottom:c.panel_height-m*2+v+w+"px",left:(k-r)/2+(g=="strip"?0:(s+c.frame_gap)*e)+(s/2-n/2)+v+"px",borderBottomColor:d,borderRightColor:d,borderLeftColor:d});break;case"bottom":b.css({top:c.panel_height-m*2+v+w+"px",left:(k-r)/2+(g=="strip"?0:(s+c.frame_gap)*e)+(s/2-n/2)+v+"px",borderTopColor:d,borderRightColor:d,borderLeftColor:d});break;case"left":b.css({right:c.panel_width-n+v+w+"px",top:t/2-m+(g=="strip"?0:(t+c.frame_gap)*e)+v+"px",borderBottomColor:d,borderRightColor:d,borderTopColor:d});break;case"right":b.css({left:c.panel_width-n+v+w+"px",top:t/2-m+(g=="strip"?0:(t+c.frame_gap)*e)+v+"px",borderBottomColor:d,borderLeftColor:d,borderTopColor:d});break}J=a(".pointer",E);var i=a("<img />");i.addClass("nav-next").attr("src",h+c.nav_theme+"/next.gif").appendTo(E).css({position:"absolute",cursor:"pointer"}).click(N);var j=a("<img />");j.addClass("nav-prev").attr("src",h+c.nav_theme+"/prev.gif").appendTo(E).css({position:"absolute",cursor:"pointer"}).click(O);if(x=="horizontal"){i.css({top:(c.filmstrip_position=="top"?Math.max(v,w):c.panel_height+w+v)+(t-22)/2+"px",right:(k+v*2)/2-r/2-c.frame_gap-22+"px"});j.css({top:(c.filmstrip_position=="top"?Math.max(v,w):c.panel_height+w+v)+(t-22)/2+"px",left:(k+v*2)/2-r/2-c.frame_gap-22+"px"})}else{i.css({left:(c.filmstrip_position=="left"?Math.max(v,w):c.panel_width+w+v)+(s-22)/2+13+"px",top:wrapper_height+Math.max(v,c.frame_gap)*2+"px"});j.css({left:(c.filmstrip_position=="left"?Math.max(v,w):c.panel_width+w+v)+(s-22)/2-13+"px",top:wrapper_height+Math.max(v,c.frame_gap)*2+"px"})}}function T(a,b){var c=P(E[0]);var d=c.top;var e=c.left;return a>e&&a<e+k+(x=="horizontal"?v*2:v+Math.max(v,w))&&b>d&&b<d+l+(x=="vertical"?v*2:v+Math.max(v,w))}function U(a){a=parseInt(a,10);if(isNaN(a)){a=0}return a}function V(){var b=c.show_filmstrip?a("img",G):a("img",I);b.each(function(a){A[a]=this.height;B[a]=this.width;if(c.frame_scale=="nocrop"){y[a]=Math.min(c.frame_height/A[a],c.frame_width/B[a])}else{y[a]=Math.max(c.frame_height/A[a],c.frame_width/B[a])}if(c.panel_scale=="nocrop"){z[a]=Math.min(c.panel_height/A[a],c.panel_width/B[a])}else{z[a]=Math.max(c.panel_height/A[a],c.panel_width/B[a])}});E.css({position:"relative",width:k+(x=="horizontal"?v*2:v+Math.max(v,w))+"px",height:l+(x=="vertical"?v*2:v+Math.max(v,w))+"px"});if(c.show_filmstrip){S();Q()}if(c.show_panels){R()}if(c.pause_on_hover||c.show_panels&&!c.show_filmstrip){a().mousemove(function(b){if(T(b.pageX,b.pageY)){if(c.pause_on_hover){if(!j){a(document).oneTime(500,"animation_pause",function(){a(document).stopTime("transition");j=true})}}if(c.show_panels&&!c.show_filmstrip&&!D){a(".nav-next-overlay").fadeIn("fast");a(".nav-prev-overlay").fadeIn("fast");a(".nav-next",E).fadeIn("fast");a(".nav-prev",E).fadeIn("fast");D=true}}else{if(c.pause_on_hover){a(document).stopTime("animation_pause");if(j){a(document).everyTime(c.transition_interval,"transition",function(){N()});j=false}}if(c.show_panels&&!c.show_filmstrip&&D){a(".nav-next-overlay").fadeOut("fast");a(".nav-prev-overlay").fadeOut("fast");a(".nav-next",E).fadeOut("fast");a(".nav-prev",E).fadeOut("fast");D=false}}})}F.css("visibility","visible");E.css("visibility","visible");a(".loader",E).fadeOut("1000",function(){K(e);if(f>1){a(document).everyTime(c.transition_interval,"transition",function(){N()})}})}var c=a.extend(a.fn.galleryView.defaults,b);var d;var e=0;var f=0;var g;var h;var j=false;var k;var l;var m;var n;var o;var q;var r;var s;var t;var u=20;var v;var w;var x;var y=new Object;var z=new Object;var A=new Object;var B=new Object;var C=true;var D=false;var E;var F;var G;var H;var I;var J;return this.each(function(){a(this).css("visibility","hidden");a(this).wrap("<div></div>");E=a(this).parent();E.css("visibility","hidden").attr("id",a(this).attr("id")).addClass("gallery g2");a(this).removeAttr("id").addClass("filmstrip");a(document).stopTime("transition");a(document).stopTime("animation_pause");d=E.attr("id");C=a(".panel-content",E).length==0;m=c.pointer_size;n=c.pointer_size*2;x=c.filmstrip_position=="top"||c.filmstrip_position=="bottom"?"horizontal":"vertical";if(x=="vertical")c.show_captions=false;a("script").each(function(b){var c=a(this);if(c.attr("src")&&c.attr("src").match(/jquery\.galleryview/)){loader_path=c.attr("src").split("jquery.galleryview")[0];h=c.attr("src").split("jquery.galleryview")[0]+"themes/"}});F=a(".filmstrip",E);G=a("li",F);G.addClass("frame");if(c.show_panels){for(i=G.length-1;i>=0;i--){if(G.eq(i).find(".panel-content").length>0){G.eq(i).find(".panel-content").remove().prependTo(E).addClass("panel")}else{p=a("<div>");p.addClass("panel");im=a("<img />");im.attr("src",G.eq(i).find("img").eq(0).attr("src")).appendTo(p);p.prependTo(E);G.eq(i).find(".panel-overlay").remove().appendTo(p)}}}else{a(".panel-overlay",G).remove();a(".panel-content",G).remove()}if(!c.show_filmstrip){F.remove()}else{G.each(function(b){if(a(this).find("a").length>0){a(this).find("a").wrap('<div class="img_wrap"></div>')}else{a(this).find("img").wrap('<div class="img_wrap"></div>')}});H=a(".img_wrap",G)}I=a(".panel",E);if(!c.show_panels){c.panel_height=0;c.panel_width=0}s=c.frame_width+L(H);t=c.frame_height+M(H);f=c.show_panels?I.length:G.length;if(x=="horizontal"){strip_size=c.show_panels?Math.floor((c.panel_width-(c.frame_gap+22)*2)/(s+c.frame_gap)):Math.min(f,c.filmstrip_size)}else{strip_size=c.show_panels?Math.floor((c.panel_height-(c.frame_gap+22))/(t+c.frame_gap)):Math.min(f,c.filmstrip_size)}if(strip_size>=f){g="pointer";strip_size=f}else{g="strip"}e=(strip_size<f?f:0)+c.start_frame-1;w=c.show_panels?U(F.css("marginTop")):0;F.css("margin","0px");if(x=="horizontal"){k=c.show_panels?c.panel_width:strip_size*(s+c.frame_gap)+44+c.frame_gap;l=(c.show_panels?c.panel_height:0)+(c.show_filmstrip?t+w+(c.show_captions?u:0):0)}else{l=c.show_panels?c.panel_height:strip_size*(t+c.frame_gap)+22;k=(c.show_panels?c.panel_width:0)+(c.show_filmstrip?s+w:0)}if(x=="horizontal"){if(g=="pointer"){o=s*f+c.frame_gap*f}else{o=s*f*3+c.frame_gap*f*3}}else{o=s+w}if(x=="horizontal"){q=t+w+(c.show_captions?u:0)}else{if(g=="pointer"){q=t*f+c.frame_gap*f}else{q=t*f*3+c.frame_gap*f*3}}r=strip_size*s+(strip_size-1)*c.frame_gap;wrapper_height=strip_size*t+(strip_size-1)*c.frame_gap;v=U(E.css("paddingTop"));E.css("padding","0px");galleryPos=P(E[0]);a("<div>").addClass("loader").css({position:"absolute",zIndex:"32666",opacity:1,top:"0px",left:"0px",width:k+(x=="horizontal"?v*2:v+Math.max(v,w))+"px",height:l+(x=="vertical"?v*2:v+Math.max(v,w))+"px"}).appendTo(E);if(!window_loaded){a(window).load(function(){window_loaded=true;V()})}else{V()}})};a.fn.galleryView.defaults={show_panels:true,show_filmstrip:true,panel_width:600,panel_height:400,frame_width:60,frame_height:40,start_frame:1,filmstrip_size:3,transition_speed:800,transition_interval:4e3,overlay_opacity:.7,frame_opacity:.3,pointer_size:8,nav_theme:"dark",easing:"swing",filmstrip_position:"bottom",overlay_position:"bottom",panel_scale:"nocrop",frame_scale:"crop",frame_gap:5,show_captions:false,fade_panels:true,pause_on_hover:false,overlay_starting_point:"None",overlay_width:"None",overlay_height:"None"}})(jQuery)